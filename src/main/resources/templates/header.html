<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <!--    <link rel="stylesheet" href="home.css"/>-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!--  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>-->

  <!--  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script>-->
  <script src="https://code.jquery.com/jquery-3.6.0.js"
          integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
          crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
          integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
          crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
          integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
          crossorigin="anonymous"></script>
</head>
<body>
<nav class="navbar header navbar-expand-md navbar-dark bg-primary" id="myHeader">
  <div class="container-fluid">
    <a class="navbar-brand" href="home">
      <img style=" max-height:50px;
    max-width:50px;  image-rendering: crisp-edges;" src="../static/raw-logo.png">
      Shopping Center</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-end" id="navbarsExampleDefault">
      <ul class="navbar-nav m-auto">
        <li class="nav-item home">
          <a class="nav-link" href="home">Home</a>
        </li>
        <li class="nav-item product">
          <a class="nav-link" href="product-list">Product</a>
        </li>
        <li class="nav-item contact">
          <a class="nav-link" href="contact.html">Contact</a>
        </li>
        <li class="nav-item login" id="log-field">
          <!--                    <a class="nav-link" href="login">Login</a>-->
        </li>
      </ul>
      <div class="nav-link float-right dropdown dropdown-toggle user" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <i class="fa" id="icon-user">
        </i>
        <a class="username" id="user" href="#"></a>
        <div class="dropdown-menu bg-primary" aria-labelledby="dropdownMenuButton">
          <div class="dropdown-item profile">
            <a class="" id="profile" href="profile"><i class="fa fa-user-circle" ></i> My Profile</a>
          </div>
          <div class="dropdown-item displaycart">

          </div>

        </div>
      </div>
    </div>
  </div>
</nav>
</body>
<script>
  $('.dropdown-item a').click(function(e){
    $(".dropdown-menu").addClass("show");
  });
</script>
<script>
  $(document).ready(function() {
    loaduser();
    check_curent_page();
  });
  // When the user scrolls the page, execute myFunction
  window.onscroll = function() {myFunction()};

  var page_name = document.title;
  function check_curent_page(){
    switch (page_name){
      case 'Home':
        $(".home").addClass("active m-auto");

            break;

      case 'Product List':
        $(".product").addClass("active m-auto");
            break;
      case 'Login':
        $(".login").addClass("active m-auto");
        break;
      case 'Sign Up':
        $(".login").addClass("active m-auto");

        break;
      default : break;
    }
  }
  // Get the header
  var header = document.getElementById("myHeader");

  // Get the offset position of the navbar
  var sticky = header.offsetTop;

  // Add the sticky class to the header when you reach its scroll position. Remove "sticky" when you leave the scroll position
  function myFunction() {
    if (window.pageYOffset > sticky) {
      header.classList.add("sticky");
    } else {
      header.classList.remove("sticky");
    }
  }
  function loaduser(){
    $.get("http://localhost:8080/username",function (data){
      const object = JSON.parse(data);
      $(".username").html(object.username);
      $(".username").html(object.name);

      if(object.authenticated !== false){
        $("#log-field").html("<a class=\"nav-link\" onclick='logout()' href=\"#\">Logout</a>");
        $("#icon-user").addClass("fa-user");

      }
      else{
        $("#log-field").html("<a class=\"nav-link\" href=\"login\">Login</a>");
        $("#icon-user").addClass("fa-user-secret");
        $("#icon-user a").addClass("disabled");
        $("#dropdownMenuButton").removeClass("dropdown dropdown-toggle");
        $("#dropdownMenuButton").removeAttr("data-toggle");
        $(".dropdown-menu").css("display: none");
      }
      let userAuthentication = JSON.parse(data);
      $.map(userAuthentication.authorities, function(elem, index) {

        if (elem.authority === "SHOP_PRIVILEGE"){
          $(".displaycart").append("<a href=\"#\" onclick='redirectToShop()'><i class=\"fas fa-store\" ></i> My Shop</a>")

        } else if (elem.authority === "USER_PRIVILEGE"){
          $(".displaycart").append( "<a href=\"#\" onclick='redirectToCart()'><i class=\"fa fa-shopping-cart\" ></i> My Cart</a>");


        }
      });
    })
  }

  function redirectToShop(){
    window.location.href = "seller-product"
  }

  function redirectToCart(){
    window.location.href = "cart"
  }

  function logout(){
    var leave = confirm("Do you want to leave?");
    if(leave){
      $.post("http://localhost:8080/logout");
      window.location.reload();
    }
  }
</script>
</html>